{% extends "base.html" %}

{% block title %}카테고리 관리 - APS 준비도 진단{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>평가 영역(카테고리) 관리</h2>
    <div>
        <a href="{{ url_for('new_category') }}" class="btn btn-success me-2">
            <i class="fas fa-plus"></i> 새 카테고리 추가
        </a>
        <a href="{{ url_for('questions') }}" class="btn btn-secondary">문항 관리로</a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <table class="table table-hover">
            <thead class="table-dark">
                <tr>
                    <th>순서</th>
                    <th>영역명</th>
                    <th>가중치</th>
                    <th>설명</th>
                    <th>문항수</th>
                    <th>작업</th>
                </tr>
            </thead>
            <tbody>
                {% for category in categories %}
                <tr>
                    <td>{{ category[4] }}</td>
                    <td><strong>{{ category[1] }}</strong></td>
                    <td>{{ (category[2] * 100)|int }}%</td>
                    <td class="text-muted">{{ category[3] }}</td>
                    <td><span class="badge bg-info">{{ category[5] }}개</span></td>
                    <td>
                        <a href="{{ url_for('edit_category', category_id=category[0]) }}" 
                           class="btn btn-sm btn-outline-primary me-1">수정</a>
                        {% if category[5] == 0 %}
                        <form method="POST" action="{{ url_for('delete_category', category_id=category[0]) }}" 
                              style="display: inline;" 
                              onsubmit="return confirm('이 카테고리를 정말 삭제하시겠습니까?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger">삭제</button>
                        </form>
                        {% else %}
                        <button type="button" class="btn btn-sm btn-outline-secondary" disabled
                                title="문항이 연결되어 있어 삭제할 수 없습니다">삭제</button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="alert alert-info mt-4">
    <strong>참고:</strong> 카테고리의 가중치 합계는 1.0(100%)이 되어야 합니다.
    현재 합계: <strong>{{ "%.0f"|format((categories|sum(attribute=2)) * 100) }}%</strong>
</div>
{% endblock %}
